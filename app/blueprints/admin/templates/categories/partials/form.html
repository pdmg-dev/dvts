{%
  set config = {
    'create': {
      'title': 'New Category',
      'button': 'Create',
      'btn_class': 'btn-primary',
    },
    'update': {
      'title': 'Edit Category',
      'button': 'Save',
      'btn_class': 'btn-primary',
    },
    'delete': {
      'title': 'Remove Category',
      'button': 'Delete',
      'btn_class': 'btn-danger',
    }
  }[action]
%}

{% if action == 'delete' %}
  <h5 class="modal-title" id="modalTitle" hx-swap-oob="true">Remove Category</h5>
{% endif %}

{% if action != 'delete' %}
  <form
    id="categoryForm"
    hx-post="{% if action == 'update' %}
      {{ url_for('admin.category_update_post', category_id=category_id) }}
    {% else %}
      {{ url_for('admin.category_create_post') }}
    {% endif %}"
    hx-target="#modalBody"
    hx-swap="innerHTML"
    novalidate
  >
    {{ form.hidden_tag() }}

    {{ form.name.label(class="form-label") }}
    {{ form.name(class="form-control " ~ ('is-invalid' if form.name.errors else ''), id="categoryNameInput") }}

    {% for error in form.name.errors %}
      <div class="invalid-feedback">{{ error }}</div>
    {% endfor %}
  </form>
{% else %}
  <form id="categoryForm" hx-post="{{ url_for('admin.category_delete_post', category_id=category.id) }}">
    <p>Are you sure you want to delete <strong>{{ category.name }}</strong>?</p>
  </form>
{% endif %}

<script>
  document.body.addEventListener("htmx:afterSwap", function () {
    const modal = document.getElementById("categoryModal");
    const titleEl = modal.querySelector(".modal-title");
    const btnEl = document.getElementById("modalActionBtn");

    // Set the modal title
    titleEl.textContent = "{{ config.title }}";

    // Reset and apply correct styles
    btnEl.classList.remove("btn-primary", "btn-danger");
    btnEl.classList.add("{{ config.btn_class }}");

    // Set the button text
    btnEl.textContent = "{{ config.button }}";
  });

  // Focus the input field when the modal is shown
  const categoryModal = document.getElementById("categoryModal");
  categoryModal.addEventListener("shown.bs.modal", function () {
    const input = document.getElementById("categoryNameInput");
    if (input) {
      input.focus();
    }
  });
</script>
