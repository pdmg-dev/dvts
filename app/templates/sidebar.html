<aside class="position-fixed d-flex flex-column" id="sidebar">
  <nav class="d-flex flex-grow-1 flex-column ms-2">
    <!-- Top section -->
    <button
      type="button"
      class="btn btn-primary btn-main d-flex align-items-center justify-content-center gap-1 mt-1 mb-2"
      hx-get="{{ url_for('voucher.new_voucher') }}"
      hx-target="#floatingCardContainer"
      hx-swap="innerHTML"
      hx-push-url="true"
    >
      <i class="bi bi-plus fs-2"></i>
      <span class="fw-medium">New Voucher</span>
    </button>
    <div class="scrollable-sidebar d-flex flex-column flex-grow-1">
      <ul class="nav flex-column mt-2">
        <li>
          <a
            href="#"
            hx-get="{{ url_for('voucher.all_vouchers') }}"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="true"
            class="nav-link fw-medium {% if request.endpoint in ['voucher.all_vouchers', 'voucher.view_voucher', 'voucher.new_voucher'] %}active{% endif %}"
          >
            <i class="bi bi-receipt fs-5"></i>
            Vouchers
            <span class="text-muted ms-auto small"> {{ total_vouchers }}</span>
            <i
              class="bi bi-chevron-down m-0 px-2 py-2"
              data-bs-toggle="collapse"
              data-bs-target="#voucherMenu"
              aria-expanded="false"
              aria-controls="voucherMenu"
              onclick="event.stopPropagation()"
            ></i>
          </a>
        </li>
        <li class="collapse" id="voucherMenu">
          <a href="#" class="nav-link"><i class="bi bi-box-arrow-down fs-5"></i>Received</a>
          <a href="#" class="nav-link"><i class="bi bi-check-circle fs-5"></i>Checked</a>
          <a href="#" class="nav-link"><i class="bi bi-arrow-repeat fs-5"></i>Processed</a>
          <a href="#" class="nav-link"><i class="bi bi-patch-check fs-5"></i>Approved</a>
          <a href="#" class="nav-link"><i class="bi bi-box-arrow-up fs-5"></i>Released</a>
        </li>
        <li>
          <a href="#" class="nav-link"><i class="bi bi-bar-chart fs-5"></i>Reports</a>
        </li>
        <li>
          <a href="#" class="nav-link"><i class="bi bi-people fs-5"></i>People</a>
        </li>
        <hr />
        <li>
          <a
            href="{{ url_for('admin.user_index') }}"
            hx-get="{{ url_for('admin.user_index') }}"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="true"
            class="nav-link {% if request.endpoint == 'admin.user_index' %}active{% endif %}"
            ><i class="bi bi-person-gear fs-5"></i>Manage users</a
          >
        </li>
        <li>
          <a
            href="{{ url_for('admin.role_index') }}"
            hx-get="{{ url_for('admin.role_index') }}"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="true"
            class="nav-link {% if request.endpoint == 'admin.role_index' %}active{% endif %}"
            ><i class="bi bi-shield-lock fs-5"></i>Manage roles</a
          >
        </li>
        <li>
          <a
            href="{{ url_for('admin.office_index') }}"
            hx-get="{{ url_for('admin.office_index') }}"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="true"
            class="nav-link {% if request.endpoint == 'admin.office_index' %}active{% endif %}"
            ><i class="bi bi-building-gear fs-5"></i>Manage offices</a
          >
        </li>
        <li>
          <a
            href="{{ url_for('admin.category_index') }}"
            hx-get="{{ url_for('admin.category_index') }}"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="true"
            class="nav-link {% if request.endpoint == 'admin.category_index' %}active{% endif %}"
            ><i class="bi bi-tag fs-5"></i>Manage categories</a
          >
        </li>
      </ul>

      <ul class="nav flex-column mt-auto mb-3">
        <li>
          <a href="#" class="nav-link"><i class="bi bi-clock-history fs-5"></i>Activity</a>
        </li>
        <li>
          <a href="#" class="nav-link"><i class="bi bi-person fs-5"></i>Profile</a>
        </li>
        <li>
          <a href="#" class="nav-link"><i class="bi bi-gear fs-5"></i>Settings</a>
        </li>
      </ul>
    </div>
  </nav>
</aside>

<script>
  function initNavLinkActiveState() {
    // Get current path from the browser
    const currentPath = window.location.pathname;

    // Loop through all nav links
    document.querySelectorAll("#sidebar .nav-link").forEach((link) => {
      const href = link.getAttribute("hx-get") || link.getAttribute("href");

      if (href && currentPath === href) {
        // Remove active from others
        document.querySelectorAll("#sidebar .nav-link.active").forEach((activeLink) => {
          activeLink.classList.remove("active");
        });

        // Add active to the matching link
        link.classList.add("active");
      }
    });
  }

  document.addEventListener("htmx:afterSwap", function () {
    initNavLinkActiveState();
  });

  document.addEventListener("DOMContentLoaded", function () {
    initNavLinkActiveState();
  });
</script>
