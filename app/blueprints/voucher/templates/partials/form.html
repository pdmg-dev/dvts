<form
  class="d-flex flex-column flex-grow-1"
  id="newVoucherForm"
  hx-post="{{ url_for('voucher.save_voucher') }}"
  hx-target="#voucherFormContainer"
  hx-swap="innerHTML"
  novalidate
  enctype="multipart/form-data"
>
  {{ form.csrf_token() }}

  <div class="mb-1 text-muted section-header">System Information</div>
  <hr class="mt-1 mb-3" />

  <div class="row mb-3">
    {{ form.date_received.label(class_="col-sm-2 col-form-label col-form-label-sm") }}
    <div class="col-sm-5">
      <div
        class="input-group input-group-sm"
        id="dateReceivedPicker"
        data-td-target-input="nearest"
        data-td-target-toggle="nearest"
      >
        {{
          form.date_received(
              class="form-control form-control-sm " ~ ('is-invalid' if form.date_received.errors else ''),
              id="dateReceivedInput",
              **{'data-td-target': '#dateReceivedPicker'}
          )
        }}

        <span class="input-group-text" data-td-target="#dateReceivedPicker" data-td-toggle="datetimepicker">
          <i class="bi bi-calendar"></i>
        </span>
      </div>

      {% for err in form.date_received.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}

      <script src="{{ url_for('static', filename='js/datepicker.js')}}"></script>
    </div>

    {{ form.category_id.label(class_="col-sm-2 col-form-label col-form-label-sm") }}
    <div class="col-sm-3">
      <input
        type="hidden"
        name="category_id"
        id="category"
        value="{% if form.category_id.data %}{{ form.category_id.data }}{% else %}{{ 0 }}{% endif %}"
      />
      <div class="dropdown w-100">
        <input
          type="text"
          id="categoryInput"
          class="form-control form-control-sm {{ 'is-invalid' if form.category_id.errors else '' }}"
          data-bs-toggle="dropdown"
          aria-expanded="false"
          autocomplete="off"
          value="{% if form.category_id.data %}{{ dict(form.category_id.choices).get(form.category_id.data) }}{% endif %}"
        />
        <ul class="dropdown-menu w-100" id="categoryMenu">
          {% for value, label in form.category_id.choices %}
            <li>
              <button type="button" class="dropdown-item category-option" data-value="{{ value }}">{{ label }}</button>
            </li>
          {% endfor %}
        </ul>
      </div>
      {% for err in form.category_id.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="mb-1 text-muted section-header">Disbursement Voucher</div>
  <hr class="mt-1 mb-3" />

  <div class="row mb-2 d-flex align-items-center">
    {{ form.dv_number.label(class_="col-sm-2 col-form-label col-form-label-sm") }}
    <div class="col-sm-5">
      {{
        form.dv_number(
             class="form-control form-control-sm " ~ ('is-invalid' if form.dv_number.errors else ''),
             id="dvNumber", disabled=true
        )
      }}
      {% for err in form.dv_number.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>

    {{ form.mode_of_payment.label(class_="col-sm-2 col-form-label-sm", id="modeOfPayment") }}
    <div class="col-sm-3">
      {{
        form.mode_of_payment(
          class="form-select form-select-sm form-control" ~ ('is-invalid' if form.mode_of_payment.errors else ''),
          id="modeOfPaymentSelect", disabled=true
        )
      }}
      {% for err in form.mode_of_payment.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row mb-2">
    {{ form.payee.label(class_="col-sm-2 col-form-label-sm") }}
    <div class="col-sm-5">
      {{
        form.payee(
             class="form-control form-control-sm " ~ ('is-invalid' if form.payee.errors else ''),
             id="payee"
        )
      }}
      {% for err in form.payee.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>

    {{ form.obr_number.label(class_="col-sm-2 col-form-label-sm") }}
    <div class="col-sm-3">
      {{
        form.obr_number(
             class="form-control form-control-sm " ~ ('is-invalid' if form.obr_number.errors else ''),
             id="obrNumber", placeholder="(Optional)"
        )
      }}
      {% for err in form.obr_number.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row mb-2">
    {{ form.address.label(class_="col-sm-2 col-form-label-sm") }}
    <div class="col-sm-5">
      {{
        form.address(
             class="form-control form-control-sm " ~ ('is-invalid' if form.address.errors else ''),
             id="address", placeholder="(Optional)"
        )
      }}
      {% for err in form.address.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>

    {{ form.resp_center_id.label(class_="col-sm-2 col-form-label col-form-label-sm") }}
    <div class="col-sm-3">
      <input
        type="hidden"
        id="respCenterId"
        name="resp_center_id"
        value="{% if form.resp_center_id.data %}{{ form.resp_center_id.data }}{% else %}{{ 0 }}{% endif %}"
      />

      <div class="dropdown w-100">
        <input
          type="text"
          id="respCenterInput"
          class="form-control form-control-sm {{ 'is-invalid' if form.resp_center_id.errors else '' }}"
          data-bs-toggle="dropdown"
          aria-expanded="false"
          autocomplete="off"
          value="{% if form.resp_center_id.data %}{{ dict(form.resp_center_id.choices).get(form.resp_center_id.data) }}{% endif %}"
        />
        <ul class="dropdown-menu" id="respCenterMenu">
          {% for value, label in form.resp_center_id.choices %}
            {% set rc = form._resp_centers.get(value) %}
            <li>
              <button
                type="button"
                class="dropdown-item resp-center-option"
                data-value="{{ value }}"
                data-code="{% if rc %}{{ rc.code }}{% endif %}"
                data-acronym="{% if rc %}{{ rc.acronym }}{% endif %}"
              >
                {{ label }}
              </button>
            </li>
          {% endfor %}
        </ul>
      </div>
      {% for err in form.resp_center_id.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>
  </div>

  <div class="row mb-2">
    {{ form.particulars.label(class_="col-sm-2 col-form-label col-form-label-sm") }}
    <div class="col-sm-5">
      {{
        form.particulars(
             class="form-control form-control-sm " ~ ('is-invalid' if form.particulars.errors else ''),
             rows="5",
        )
      }}
      {% for err in form.particulars.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>

    {{ form.amount.label(class_="col-sm-2 col-form-label col-form-label-sm") }}
    <div class="col-sm-3">
      {{
        form.amount(
             class="form-control form-control-sm " ~ ('is-invalid' if form.amount.errors else ''),
        )
      }}
      {% for err in form.amount.errors %}
        <div class="invalid-feedback">{{ err }}</div>
      {% endfor %}
    </div>
  </div>
</form>

<script src="{{ url_for('static', filename='js/form.js') }}"></script>
